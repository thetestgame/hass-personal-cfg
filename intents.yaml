
MutePlayer:
  action:
    service: "media_player.volume_mute"
    data:
      entity_id: "{{ media_player }}"
      is_volume_muted: "{{ mute_or_unmute }}"
  speech:
    text: |
      {% if mute_or_unmute == "true" %}
        Muted
      {% else %}
        Unmuted
      {% endif %}

MutePlayerArea:
  action:
    service: "media_player.volume_mute"
    data:
      entity_id: "{{ expand(states.media_player) | selectattr('entity_id', 'in', area_entities(area)) | select('search', 'ma_') | selectattr('state', 'eq', 'playing') | map(attribute='entity_id') | join }}"
      is_volume_muted: "{{ mute_or_unmute }}"
  speech:
    text: |
      {% if mute_or_unmute == "true" %}
        Muted
      {% else %}
        Unmuted
      {% endif %}
      
ShuffleSet:
  action:
    service: "media_player.shuffle_set"
    data:
      entity_id: "{{ media_player }}"
      shuffle: "{{ shuffle_mode }}"
  speech:
    text: "Queue shuffle mode set"

ShuffleSetArea:
  action:
    service: "media_player.shuffle_set"
    data:
      entity_id: "{{ expand(states.media_player) | selectattr('entity_id', 'in', area_entities(area)) | select('search', 'ma_') |map(attribute='entity_id') | join }}"
      shuffle: "{{ shuffle_mode }}"
  speech:
    text: "Queue shuffle mode set"

RepeatSet:
  action:
    service: "media_player.repeat_set"
    data:
      entity_id: "{{ media_player }}"
      repeat: "{{ repeat_mode }}"
  speech:
    text: "Queue repeat mode set"

RepeatSetArea:
  action:
    service: "media_player.repeat_set"
    data:
      entity_id: "{{ expand(states.media_player) | selectattr('entity_id', 'in', area_entities(area)) | select('search', 'ma_') |map(attribute='entity_id') | join }}"
      repeat: "{{ repeat_mode }}"
  speech:
    text: "Queue repeat mode set"

ClearQueueArea:
  action:
    service: "media_player.clear_playlist"
    data:
      entity_id: "{{ expand(states.media_player) | selectattr('entity_id', 'in', area_entities(area)) | select('search', 'ma_') | selectattr('state', 'eq', 'playing') | map(attribute='entity_id') | join }}"
  speech:
    text: "{{ expand(states.media_player) | selectattr('entity_id', 'in', area_entities('study')) | select('search', 'ma_') |map(attribute='attributes.friendly_name') | join }} Queue cleared"
  
ClearQueue:
  action:
    service: "media_player.clear_playlist"
    data:
      entity_id: "{{ media_player }}"
  speech:
    text: "Queue cleared"
  
PlayerStop:
  action:
    service: "media_player.media_stop"
    data:
      entity_id: "{{ media_player }}"
  speech:
    text: "Stopped"
  
PlayerStopArea:
  action:
    service: "media_player.media_stop"
    data:
      entity_id: "{{ expand(states.media_player) | selectattr('entity_id', 'in', area_entities(area)) | select('search', 'ma_') | selectattr('state', 'eq', 'playing') | map(attribute='entity_id') | join }}"
  speech:
    text: "Stopped"

SelectSource:
  action:
    service: "media_player.select_source"
    data:
      entity_id: "{{ media_player }}"
      source: "{{ desired_source }}"
  speech:
    text: "{{ media_player }} source set to {{ desired_source }}"
    
PlayerJoin:
  action:
    service: "media_player.join"
    target:
      entity_id: "{{ media_player_group }}"
    data:
      group_members: "{{ media_player }}"
  speech:
    text: "{{ states.media_player | selectattr('entity_id','eq',media_player) | map(attribute='attributes.friendly_name') | list | join }}  joined to {{ states.media_player | selectattr('entity_id','eq',media_player_group) | map(attribute='attributes.friendly_name') | list | join }} "

PlayerUnjoin:
  action:
    service: "media_player.unjoin"
    target:
      entity_id: "{{ media_player }}"
  speech:
    text: "{{ states.media_player | selectattr('entity_id','eq',media_player) | map(attribute='attributes.friendly_name') | list | join }} removed from group"